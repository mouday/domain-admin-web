import{H as $}from"./highlight-lib.ebf3907c.js";import{C as v}from"./ConnectStatus.fd85c3a8.js";import{_ as C}from"./index.932c6049.js";import{al as c,o as h,H as S,I as s,a as r,c as w,Q as l,O as p,ar as z,J as V,M as y}from"./vendor-vue.872ec2a8.js";import{h as T}from"./highlight-util.6edc97d1.js";import"./element-plus.39304440.js";import"./element-icon.0ab2c14a.js";import"./vendor-lib.5a71f1ae.js";const O={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}},R={style:{"max-height":"600px","overflow-y":"auto"}},B=["innerHTML"];function A(e,t,n,m,i,d){const o=c("el-dialog");return h(),S(o,{title:"\u53C2\u6570\u8BE6\u60C5",modelValue:d.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=u=>d.dialogVisible=u),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:d.handleDialogClose},{default:s(()=>[r("div",R,[r("pre",null,[r("code",{class:"language-json",innerHTML:n.row.params},null,8,B)])])]),_:1},8,["modelValue","onClose"])}const L=C(O,[["render",A]]),P={name:"",components:{ConnectStatus:v,DataFormParamsDialog:L},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(e){this.currentRow=e,this.dialogVisible=!0},async handleDeleteClick(e){let t={id:e.id};const n=await this.$http.function(t);n.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(n.msg)},async handleStatusChange(e){let t={id:e.id};const n=await this.$http.function(t);n.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(n.msg)},handleUpdateSuccess(){this.$emit("on-success")},handleShowDetail(e){this.currentRow=e,this.dialogVisible=!0}},mounted(){$.highlightAll()},created(){}},j={key:1};function H(e,t,n,m,i,d){const o=c("el-table-column"),u=c("ConnectStatus"),g=c("el-link"),_=c("el-table"),f=c("DataFormParamsDialog");return h(),w("div",null,[l(_,{data:n.list,stripe:"",border:""},{default:s(()=>[l(o,{label:e.$t("\u5E8F\u53F7"),align:"center",prop:"id",width:"60"},{default:s(a=>[r("span",null,p(a.$index+1),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u7528\u6237"),"header-align":"center",align:"center",prop:"create_time",width:"140"},{default:s(a=>[r("span",null,p(a.row.user_name||"-"),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u4EFB\u52A1\u540D\u79F0"),"header-align":"center",align:"center",width:"180",prop:"create_time"},{default:s(a=>[r("span",null,p(a.row.task_name||"-"),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u5F00\u59CB\u65F6\u95F4"),"header-align":"center",align:"center",width:"180",prop:"create_time"},{default:s(a=>[r("span",null,p(a.row.start_time||"-"),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u7ED3\u675F\u65F6\u95F4"),"header-align":"center",align:"center",width:"180",prop:"end_time"},{default:s(a=>[r("span",null,p(a.row.end_time||"-"),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u6301\u7EED\u65F6\u95F4"),"header-align":"center",align:"center",width:"80",prop:"total_time_label"},{default:s(a=>[r("span",null,p(a.row.total_time_label||"-"),1)]),_:1},8,["label"]),l(o,{label:e.$t("\u72B6\u6001"),"header-align":"center",align:"center",prop:"status",width:"60"},{default:s(a=>[l(u,{value:a.row.status},null,8,["value"])]),_:1},8,["label"]),l(o,{label:e.$t("\u53C2\u6570"),"header-align":"center",align:"center",prop:"params",width:"60"},{default:s(a=>[a.row.params?(h(),S(g,{key:0,underline:!1,onClick:D=>d.handleShowDetail(a.row)},{default:s(()=>t[1]||(t[1]=[r("span",null,"\u67E5\u770B",-1)])),_:2,__:[1]},1032,["onClick"])):(h(),w("span",j,"-"))]),_:1},8,["label"]),l(o,{label:e.$t("\u6267\u884C\u7ED3\u679C"),"header-align":"center",align:"center",prop:"status"},{default:s(a=>[r("span",null,p(a.row.result||"-"),1)]),_:1},8,["label"])]),_:1},8,["data"]),l(f,{visible:i.dialogVisible,"onUpdate:visible":t[0]||(t[0]=a=>i.dialogVisible=a),row:i.currentRow,onOnSuccess:e.handleSuccess},null,8,["visible","row","onOnSuccess"])])}const N=C(P,[["render",H]]),U={name:"log-scheduler-list",props:{},components:{DataTable:N},data(){return{list:[],total:0,page:1,size:20,keywords:"",loading:!0,dialogVisible:!1,pageSizeCachekey:"pageSize"}},computed:{},methods:{resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let e={ticket:this.ticket,page:this.page,size:this.size,keywords:this.keywords};const t=await this.$http.getAsyncTaskLogList(e);t.code==0&&(this.list=t.data.list.map(n=>{try{n.params=JSON.stringify(JSON.parse(n.params),null,2)}catch{}return n.params=T(n.params,{language:"json"}).value,n}),this.total=t.data.total),this.loading=!1},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},handleSizeChange(e){localStorage.setItem(this.pageSizeCachekey,e),this.resetData()},loadPageSize(){let e=localStorage.getItem(this.pageSizeCachekey);e&&(this.size=parseInt(e))},async handleBatchDeleteConfirm(){let e=this.$loading({fullscreen:!0});try{const t=await this.$http.clearAsyncTaskLogList();t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()):this.$msg.error(t.msg)}catch(t){console.log(t)}finally{this.$nextTick(()=>{e.close()})}}},created(){this.loadPageSize(),this.getData()}},I={class:"app-container"},J={class:"flex justify-end mb-sm"};function x(e,t,n,m,i,d){const o=c("Delete"),u=c("el-icon"),g=c("el-link"),_=c("el-popconfirm"),f=c("Refresh"),a=c("DataTable"),D=c("el-pagination"),k=z("loading");return h(),w("div",I,[r("div",J,[t[2]||(t[2]=r("div",null,null,-1)),l(_,{title:"\u786E\u5B9A\u6E05\u7A7A\u65E5\u5FD7\uFF1F",onConfirm:d.handleBatchDeleteConfirm},{reference:s(()=>[l(g,{underline:!1,type:"danger",class:"mr-sm"},{default:s(()=>[l(u,null,{default:s(()=>[l(o)]),_:1}),y(p(e.$t("\u6E05\u7A7A\u65E5\u5FD7")),1)]),_:1})]),_:1},8,["onConfirm"]),l(g,{underline:!1,type:"primary",disabled:i.loading,onClick:d.getData},{default:s(()=>[l(u,null,{default:s(()=>[l(f)]),_:1}),y(p(e.$t("\u5237\u65B0")),1)]),_:1},8,["disabled","onClick"])]),V(l(a,{list:i.list,onOnSuccess:d.resetData},null,8,["list","onOnSuccess"]),[[k,i.loading]]),l(D,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:i.total,"page-size":i.size,"onUpdate:pageSize":t[0]||(t[0]=b=>i.size=b),"current-page":i.page,"onUpdate:currentPage":t[1]||(t[1]=b=>i.page=b),onCurrentChange:d.getData,onSizeChange:d.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])}const X=C(U,[["render",x]]);export{X as default};
